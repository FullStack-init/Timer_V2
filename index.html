<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporizador de Entrenamiento</title>
    <style>
        :root {
            --primary-bg: #f8fafc;
            --secondary-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --orange: #f97316;
            --teal: #14b8a6;
            --cyan: #06b6d4;
            --dark-bg: #0f172a;
            --dark-sidebar: #1e293b;
            --dark-text: #f1f5f9;
            --dark-secondary: #94a3b8;
            --dark-border: #334155;
            
            /* Temas personalizados */
            --theme-primary: #3b82f6;
            --theme-secondary: #8b5cf6;
            --theme-accent: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        body.dark-mode {
            --primary-bg: #0f172a;
            --secondary-bg: #1e293b;
            --sidebar-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }

        .app {
            display: flex;
            height: 100vh;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Espacio reservado para sidebar */
        .sidebar-reserved {
            width: 80px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 800;
        }

        /* Floating Sidebar Toggle - Mejorado */
        .sidebar-toggle {
            position: fixed;
            left: 30px;
            top: 30px;
            width: 50px;
            height: 50px;
            border-radius: 16px;
            background-color: var(--sidebar-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--border-color);
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        /* Sidebar - Mejorado con mejor posicionamiento */
        .sidebar {
            position: fixed;
            left: 20px;
            top: 100px;
            width: 260px;
            height: calc(100vh - 120px);
            background-color: var(--sidebar-bg);
            box-shadow: var(--shadow-xl);
            z-index: 900;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .sidebar.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .sidebar-header {
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sidebar-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-secondary);
            gap: 16px;
            border: 2px solid transparent;
        }

        .sidebar-item:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
            transform: translateX(8px);
        }

        .sidebar-item.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info);
            border-color: var(--info);
        }

        .sidebar-item-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-item-text {
            font-size: 16px;
            font-weight: 500;
        }

        /* Main Content - Ajustado para espacio reservado */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 20px;
            border-radius: 24px;
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-lg);
            margin-left: 100px; /* Espacio para sidebar reservado */
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-content.sidebar-open {
            margin-left: 380px; /* 80px (reservado) + 260px (sidebar) + 40px (margen) */
        }

        /* Header */
        .header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--secondary-bg);
            border-radius: 24px 24px 0 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .time-display {
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .time-display:hover {
            background-color: rgba(148, 163, 184, 0.1);
            transform: scale(1.05);
        }

        .connection-status {
            display: flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }

        .connection-status.online {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .connection-status.offline {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .connection-icon {
            margin-right: 4px;
            width: 16px;
            height: 16px;
        }

        /* Dashboard */
        .dashboard {
            flex: 1;
            padding: 24px;
            overflow: auto;
            margin-bottom: 80px; /* Espacio para los paneles */
        }

        .dashboard-layout {
            display: flex;
            flex-direction: column;
            gap: 24px;
            height: 100%;
        }

        /* Zona Focal - Temporizador */
        .zone-focal {
            background: linear-gradient(135deg, var(--secondary-bg), #f1f5f9);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 96px;
            font-weight: 700;
            letter-spacing: 4px;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .timer-display:hover {
            transform: scale(1.02);
        }

        /* Estado del Timer - Colores que cambian seg√∫n el modo */
        .timer-display.countdown {
            color: var(--danger);
        }

        .timer-display.countup {
            color: var(--success);
        }

        .timer-display.clock {
            color: var(--info);
        }

        .timer-display.amrap {
            color: var(--purple);
        }

        .timer-display.tabata {
            color: var(--orange);
        }

        /* Zona de Acci√≥n - Controles */
        .zone-accion {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin: 24px 0;
        }

        .control-button {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
            font-size: 24px;
        }

        .play-button {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .pause-button {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        .reset-button {
            background: linear-gradient(135deg, var(--text-secondary), #475569);
            color: white;
        }

        .control-button:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* Barra de Progreso */
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: rgba(148, 163, 184, 0.2);
            border-radius: 4px;
            margin: 24px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--info), var(--purple));
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Zona de Informaci√≥n */
        .zone-info {
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            background-color: rgba(148, 163, 184, 0.1);
            margin: 24px 0;
        }

        .program-info {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .program-details {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Zona de Selecci√≥n - Programas */
        .zone-seleccion {
            background-color: var(--secondary-bg);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .programs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .programs-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .programs-actions {
            display: flex;
            gap: 8px;
        }

        .programs-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: none;
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .programs-action-btn:hover {
            background-color: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .programs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
        }

        .program-card {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            user-select: none;
            min-height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .program-card:hover {
            transform: translateY(-4px);
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
            box-shadow: var(--shadow);
        }

        .program-card.selected {
            border-color: var(--info);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
            box-shadow: 0 0 0 2px var(--info), var(--shadow);
        }

        .program-favorite {
            position: absolute;
            top: 8px;
            right: 8px;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            background: none;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .program-favorite:hover {
            color: var(--warning);
            transform: scale(1.2);
        }

        .program-favorite.active {
            color: var(--warning);
        }

        .program-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .program-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .program-description {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* Drag and Drop - Mejorado */
        .program-card.dragging {
            opacity: 0.8;
            transform: rotate(3deg) scale(1.05);
            z-index: 1000;
            box-shadow: var(--shadow-xl);
            transition: all 0.2s ease;
        }

        .program-card.drag-over {
            border-color: var(--info);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
            transform: scale(1.03);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--secondary-bg);
            border-radius: 24px;
            padding: 32px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
        }

        .modal.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-buttons {
            display: flex;
            gap: 16px;
            margin-top: 32px;
        }

        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--info), #2563eb);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary), #475569);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Settings Panel - Organizado por categor√≠as */
        .settings-panel {
            position: fixed;
            bottom: 20px;
            left: 100px; /* Ajustado para espacio reservado */
            width: 380px;
            height: calc(100vh - 40px);
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-xl);
            z-index: 1500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            overflow-y: auto;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .settings-panel.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .settings-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .settings-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .settings-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        .setting-category {
            margin-bottom: 32px;
        }

        .category-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-radius: 16px;
            background-color: rgba(148, 163, 184, 0.1);
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .setting-item:hover {
            background-color: rgba(148, 163, 184, 0.2);
            transform: translateX(4px);
        }

        .setting-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--text-secondary);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Theme Creator */
        .theme-creator {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .color-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background-color: var(--primary-bg);
            color: var(--text-primary);
        }

        /* Stats Panel - Timeline visual */
        .stats-panel {
            position: fixed;
            bottom: 20px;
            left: 100px; /* Ajustado para espacio reservado */
            width: 380px;
            height: calc(100vh - 40px);
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-xl);
            z-index: 1500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            overflow-y: auto;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .stats-panel.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .stats-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stats-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stats-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        /* Timeline Visual */
        .timeline {
            position: relative;
            padding-left: 20px;
            margin-bottom: 32px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--info), var(--success));
        }

        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding-left: 24px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--info);
            border: 3px solid var(--secondary-bg);
            box-shadow: 0 0 0 2px var(--info);
        }

        .timeline-date {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .timeline-content {
            background-color: rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 16px;
            border-left: 4px solid var(--info);
        }

        .timeline-program {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .timeline-duration {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Stats Summary */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--info);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Heatmap */
        .heatmap-section {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
        }

        .heatmap-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .heatmap-day {
            aspect-ratio: 1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: transparent;
            transition: all 0.2s ease;
        }

        .heatmap-day:hover {
            transform: scale(1.1);
            color: var(--text-primary);
        }

        .heatmap-day.level-0 { background-color: rgba(148, 163, 184, 0.1); }
        .heatmap-day.level-1 { background-color: rgba(59, 130, 246, 0.3); }
        .heatmap-day.level-2 { background-color: rgba(59, 130, 246, 0.5); }
        .heatmap-day.level-3 { background-color: rgba(59, 130, 246, 0.7); }
        .heatmap-day.level-4 { background-color: rgba(59, 130, 246, 0.9); }

        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }

        /* Workouts Panel */
        .workouts-panel {
            position: fixed;
            bottom: 20px;
            left: 100px; /* Ajustado para espacio reservado */
            width: 380px;
            height: calc(100vh - 40px);
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-xl);
            z-index: 1500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            overflow-y: auto;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .workouts-panel.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .workouts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .workouts-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .workouts-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .workouts-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        .workouts-content {
            margin-bottom: 20px;
        }

        .workout-item {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .workout-item:hover {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.2), rgba(148, 163, 184, 0.1));
            transform: translateY(-2px);
            border-color: var(--info);
        }

        .workout-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .workout-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .workout-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
        }

        .workout-stat {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .workout-actions {
            display: flex;
            gap: 8px;
        }

        .workout-action-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .workout-action-btn:hover {
            background-color: rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
        }

        /* Workout Editor */
        .workout-editor {
            position: fixed;
            bottom: 20px;
            left: 100px; /* Ajustado para espacio reservado */
            width: 380px;
            height: calc(100vh - 40px);
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            overflow-y: auto;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .workout-editor.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .editor-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .editor-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editor-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        .editor-content {
            height: calc(100% - 100px);
        }

        .programs-list {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 16px;
            overflow-y: auto;
            max-height: 300px;
            margin-bottom: 24px;
        }

        .workout-sequence {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 16px;
            overflow-y: auto;
            max-height: 200px;
            margin-bottom: 24px;
        }

        .sequence-item {
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .sequence-item:hover {
            transform: translateX(4px);
            border-color: var(--info);
        }

        .sequence-item.draggable {
            cursor: move;
        }

        .sequence-item.dragging {
            opacity: 0.7;
            transform: rotate(2deg);
        }

        .sequence-controls {
            display: flex;
            gap: 8px;
        }

        .sequence-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background-color: rgba(148, 163, 184, 0.2);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .sequence-btn:hover {
            background-color: rgba(148, 163, 184, 0.3);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .editor-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        /* Preview Section */
        .preview-section {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 16px;
            padding: 20px;
            margin-top: 24px;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .preview-timeline {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 12px 0;
        }

        .preview-item {
            min-width: 120px;
            background-color: var(--secondary-bg);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 2px solid var(--border-color);
        }

        .preview-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .preview-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .preview-time {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Program Creator */
        .program-creator {
            position: fixed;
            bottom: 20px;
            left: 100px; /* Ajustado para espacio reservado */
            width: 380px;
            height: calc(100vh - 40px);
            background-color: var(--secondary-bg);
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 24px;
            overflow-y: auto;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateX(-20px);
            visibility: hidden;
        }

        .program-creator.active {
            opacity: 1;
            transform: translateX(0);
            visibility: visible;
        }

        .creator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .creator-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .creator-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .creator-close:hover {
            background-color: rgba(148, 163, 184, 0.1);
            color: var(--text-primary);
        }

        .creator-form {
            margin-bottom: 24px;
        }

        .creator-actions {
            display: flex;
            gap: 16px;
            margin-top: 24px;
        }

        .config-section {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.05));
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .config-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .zone-focal {
                padding: 24px;
            }
            
            .timer-display {
                font-size: 72px;
            }
            
            .sidebar {
                left: 15px;
                top: 90px;
                width: 240px;
                padding: 20px;
            }
            
            .settings-panel, .stats-panel, .workouts-panel, .workout-editor, .program-creator {
                width: 340px;
                height: calc(100vh - 30px);
                bottom: 15px;
                left: 100px;
            }
            
            .workout-editor, .program-creator {
                width: 340px;
                left: 100px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .timer-display {
                font-size: 48px;
            }
            
            .zone-accion {
                gap: 16px;
            }
            
            .control-button {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            .main-content {
                margin: 10px;
                border-radius: 16px;
                margin-left: 90px;
            }
            
            .main-content.sidebar-open {
                margin-left: 350px;
            }
            
            .header {
                padding: 16px;
                border-radius: 16px 16px 0 0;
            }
            
            .dashboard {
                padding: 16px;
            }
            
            .zone-focal, .zone-seleccion {
                padding: 20px;
                border-radius: 16px;
            }
            
            .sidebar-toggle {
                left: 15px;
                top: 15px;
                width: 45px;
                height: 45px;
            }
            
            .sidebar {
                left: 10px;
                top: 80px;
                width: 220px;
                padding: 16px;
            }
            
            .settings-panel, .stats-panel, .workouts-panel, .workout-editor, .program-creator {
                width: calc(100vw - 30px);
                left: 15px;
                right: 15px;
                transform: none;
            }
            
            .programs-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Espacio reservado para sidebar -->
    <div class="sidebar-reserved"></div>

    <!-- Floating Sidebar Toggle -->
    <div class="sidebar-toggle" id="sidebarToggle">
        ‚ò∞
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Men√∫</h2>
        </div>
        <div class="sidebar-items">
            <div class="sidebar-item active" id="dashboardBtn">
                <div class="sidebar-item-icon">üè†</div>
                <div class="sidebar-item-text">Dashboard</div>
            </div>
            <div class="sidebar-item" id="workoutsBtn">
                <div class="sidebar-item-icon">üèãÔ∏è</div>
                <div class="sidebar-item-text">Workouts</div>
            </div>
            <div class="sidebar-item" id="statsBtn">
                <div class="sidebar-item-icon">üìä</div>
                <div class="sidebar-item-text">Historial</div>
            </div>
            <div class="sidebar-item" id="createProgramBtn">
                <div class="sidebar-item-icon">‚ûï</div>
                <div class="sidebar-item-text">Crear Programa</div>
            </div>
            <div class="sidebar-item" id="settingsBtn">
                <div class="sidebar-item-icon">‚öôÔ∏è</div>
                <div class="sidebar-item-text">Configuraci√≥n</div>
            </div>
            <div class="sidebar-item" id="darkModeBtn">
                <div class="sidebar-item-icon">üåì</div>
                <div class="sidebar-item-text" id="darkModeText">Modo Oscuro</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="header-title">Tu Temporizador de Entrenamiento</h1>
                <div class="status-bar">
                    <div class="time-display" id="currentTime">00:00:00</div>
                    <div class="connection-status online" id="connectionStatus">
                        <span>üì∂ Online</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard - Organizaci√≥n por zonas -->
        <main class="dashboard">
            <div class="dashboard-layout">
                <!-- Zona Focal: Temporizador grande y central -->
                <div class="zone-focal">
                    <div class="timer-display" id="timerDisplay">00:00</div>
                    
                    <!-- Barra de Progreso -->
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    
                    <!-- Zona de Acci√≥n: Controles principales -->
                    <div class="zone-accion">
                        <button class="control-button play-button" id="playButton">
                            ‚ñ∂Ô∏è
                        </button>
                        <button class="control-button pause-button" id="pauseButton">
                            ‚è∏Ô∏è
                        </button>
                        <button class="control-button reset-button" id="resetButton">
                            üîÑ
                        </button>
                    </div>
                    
                    <!-- Zona de Informaci√≥n: Detalles del programa -->
                    <div class="zone-info">
                        <div class="program-info" id="programInfo">
                            Selecciona un programa de entrenamiento
                        </div>
                        <div class="program-details" id="programDetails">
                            <!-- Detalles espec√≠ficos del programa -->
                        </div>
                    </div>
                </div>

                <!-- Zona de Selecci√≥n: Programas en cuadr√≠cula -->
                <div class="zone-seleccion">
                    <div class="programs-header">
                        <h2 class="programs-title">Programas de Entrenamiento</h2>
                        <div class="programs-actions">
                            <button class="programs-action-btn" id="favoritesBtn" title="Favoritos">
                                ‚≠ê
                            </button>
                            <button class="programs-action-btn" id="refreshBtn" title="Actualizar">
                                üîÑ
                            </button>
                        </div>
                    </div>
                    <div class="programs-grid" id="programsGrid">
                        <!-- Programas se generar√°n din√°micamente -->
                    </div>
                </div>

                <!-- Heatmap Section -->
                <div class="heatmap-section">
                    <h3 class="heatmap-title">Actividad Semanal</h3>
                    <div class="heatmap-grid" id="heatmapGrid">
                        <!-- Heatmap se generar√° din√°micamente -->
                    </div>
                    <div class="heatmap-legend">
                        <span>Menos</span>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgba(148, 163, 184, 0.1);"></div>
                            <span>0</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgba(59, 130, 246, 0.3);"></div>
                            <span>1</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgba(59, 130, 246, 0.5);"></div>
                            <span>2</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgba(59, 130, 246, 0.7);"></div>
                            <span>3</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgba(59, 130, 246, 0.9);"></div>
                            <span>4+</span>
                        </div>
                        <span>M√°s</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para configuraci√≥n de programas -->
    <div class="modal" id="programModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Configurar Programa</h2>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Contenido del modal se generar√° din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Panel de Configuraci√≥n - Organizado por categor√≠as -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2 class="settings-title">Configuraci√≥n</h2>
            <button class="settings-close" id="settingsClose">&times;</button>
        </div>
        
        <!-- Categor√≠a: Sonidos -->
        <div class="setting-category">
            <h3 class="category-title">Sonidos</h3>
            <div class="setting-item">
                <span class="setting-label">Sonido de Inicio</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundStart" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <span class="setting-label">Sonido de Finalizaci√≥n</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundEnd" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <span class="setting-label">Sonido de Alerta</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundAlert" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Categor√≠a: Visual -->
        <div class="setting-category">
            <h3 class="category-title">Visual</h3>
            <div class="setting-item">
                <span class="setting-label">Animaciones</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="animations" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <span class="setting-label">Pantalla Completa</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="fullscreen">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Categor√≠a: Temas Personalizados -->
        <div class="setting-category">
            <h3 class="category-title">Temas Personalizados</h3>
            <div class="theme-creator">
                <div class="color-picker">
                    <div class="color-preview" id="primaryPreview" style="background-color: var(--theme-primary);"></div>
                    <input type="color" class="color-input" id="primaryColor" value="#3b82f6">
                    <span>Color Primario</span>
                </div>
                <div class="color-picker">
                    <div class="color-preview" id="secondaryPreview" style="background-color: var(--theme-secondary);"></div>
                    <input type="color" class="color-input" id="secondaryColor" value="#8b5cf6">
                    <span>Color Secundario</span>
                </div>
                <div class="color-picker">
                    <div class="color-preview" id="accentPreview" style="background-color: var(--theme-accent);"></div>
                    <input type="color" class="color-input" id="accentColor" value="#10b981">
                    <span>Color de Acento</span>
                </div>
                <button class="btn btn-success" id="applyTheme" style="width: 100%; margin-top: 16px;">
                    Aplicar Tema
                </button>
            </div>
        </div>
        
        <!-- Categor√≠a: Historial -->
        <div class="setting-category">
            <h3 class="category-title">Historial</h3>
            <div class="setting-item">
                <span class="setting-label">Guardar Sesiones</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="saveHistory" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <button class="btn btn-secondary" id="clearHistoryBtn" style="width: 100%; margin-top: 16px;">
                Limpiar Historial
            </button>
        </div>
    </div>

    <!-- Panel de Historial - Timeline visual -->
    <div class="stats-panel" id="statsPanel">
        <div class="stats-header">
            <h2 class="stats-title">Historial</h2>
            <button class="stats-close" id="statsClose">&times;</button>
        </div>
        
        <!-- Resumen de estad√≠sticas -->
        <div class="stats-summary">
            <div class="stat-card">
                <div class="stat-value" id="totalSessions">0</div>
                <div class="stat-label">Sesiones</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTime">0</div>
                <div class="stat-label">Horas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="favoriteProgram">-</div>
                <div class="stat-label">Favorito</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="thisWeek">0</div>
                <div class="stat-label">Esta Semana</div>
            </div>
        </div>
        
        <!-- Timeline visual -->
        <h3 class="category-title">Actividad Reciente</h3>
        <div class="timeline" id="timeline">
            <!-- Items del timeline se generar√°n din√°micamente -->
        </div>
    </div>

    <!-- Panel de Workouts -->
    <div class="workouts-panel" id="workoutsPanel">
        <div class="workouts-header">
            <h2 class="workouts-title">Workouts</h2>
            <button class="workouts-close" id="workoutsClose">&times;</button>
        </div>
        <div class="workouts-content">
            <div class="workout-item" id="createWorkoutBtn">
                <div class="workout-name">Crear Nuevo Workout</div>
                <div class="workout-description">Dise√±a tu propio entrenamiento personalizado</div>
                <div class="workout-stats">
                    <div class="workout-stat">‚è±Ô∏è Personalizado</div>
                    <div class="workout-stat">üìä Sin datos</div>
                </div>
                <div class="workout-actions">
                    <button class="workout-action-btn">‚ûï Crear</button>
                </div>
            </div>
            <div class="workout-item">
                <div class="workout-name">Workout Combinado</div>
                <div class="workout-description">Combina m√∫ltiples programas con intervalos</div>
                <div class="workout-stats">
                    <div class="workout-stat">‚è±Ô∏è 30 min</div>
                    <div class="workout-stat">üìä 85% completado</div>
                </div>
                <div class="workout-actions">
                    <button class="workout-action-btn">üîß Editar</button>
                    <button class="workout-action-btn">‚ñ∂Ô∏è Iniciar</button>
                </div>
            </div>
            <div class="workout-item">
                <div class="workout-name">Circuito Personalizado</div>
                <div class="workout-description">Secuencia de ejercicios con tiempos espec√≠ficos</div>
                <div class="workout-stats">
                    <div class="workout-stat">‚è±Ô∏è 45 min</div>
                    <div class="workout-stat">üìä 92% completado</div>
                </div>
                <div class="workout-actions">
                    <button class="workout-action-btn">üîß Editar</button>
                    <button class="workout-action-btn">‚ñ∂Ô∏è Iniciar</button>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" style="width: 100%;">
            + Nuevo Workout Personalizado
        </button>
    </div>

    <!-- Editor de Workouts Avanzado -->
    <div class="workout-editor" id="workoutEditor">
        <div class="editor-header">
            <h2 class="editor-title">Editor de Workouts</h2>
            <button class="editor-close" id="editorClose">&times;</button>
        </div>
        <div class="editor-content">
            <!-- √Årea de Origen: Programas disponibles -->
            <div class="programs-list">
                <h3>Programas Disponibles</h3>
                <div class="programs-grid" id="editorProgramsGrid">
                    <!-- Programas disponibles para arrastrar -->
                </div>
            </div>
            
            <!-- √Årea de Destino: Secuencia construida -->
            <div class="workout-sequence">
                <h3>Secuencia del Workout</h3>
                <div id="workoutSequence">
                    <!-- Secuencia de programas arrastrados -->
                    <div class="sequence-placeholder" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        Arrastra programas aqu√≠ para crear tu secuencia
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Previsualizaci√≥n del workout completo -->
        <div class="preview-section">
            <h3 class="preview-title">Previsualizaci√≥n</h3>
            <div class="preview-timeline" id="previewTimeline">
                <!-- Vista previa de la secuencia -->
            </div>
        </div>
        
        <div class="editor-actions">
            <button class="btn btn-secondary" id="cancelWorkout">Cancelar</button>
            <button class="btn btn-primary" id="saveWorkout">Guardar Workout</button>
        </div>
    </div>

    <!-- Creador de Programas -->
    <div class="program-creator" id="programCreator">
        <div class="creator-header">
            <h2 class="creator-title">Crear Programa</h2>
            <button class="creator-close" id="creatorClose">&times;</button>
        </div>
        <div class="creator-form">
            <div class="form-group">
                <label class="form-label">Nombre del Programa</label>
                <input type="text" class="form-input" id="programName" placeholder="Ej: Circuito Personalizado">
            </div>
            <div class="form-group">
                <label class="form-label">√çcono</label>
                <select class="form-select" id="programIcon">
                    <option value="üí™">üí™ - Fuerza</option>
                    <option value="üèÉ">üèÉ - Cardio</option>
                    <option value="üßò">üßò - Yoga</option>
                    <option value="‚ö°">‚ö° - Intervalos</option>
                    <option value="üî•">üî• - HIIT</option>
                    <option value="‚è±Ô∏è">‚è±Ô∏è - Temporizador</option>
                    <option value="‚öôÔ∏è">‚öôÔ∏è - Personalizado</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea class="form-input" id="programDescription" rows="3" placeholder="Describe tu programa..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Tipo de Programa</label>
                <select class="form-select" id="programType">
                    <option value="countdown">Contador Descendente</option>
                    <option value="countup">Contador Ascendente</option>
                    <option value="amrap">AMRAP</option>
                    <option value="tabata">TABATA</option>
                    <option value="custom">Personalizado</option>
                </select>
            </div>
            
            <!-- Configuraci√≥n avanzada -->
            <div class="config-section">
                <h4 class="config-title">Configuraci√≥n Avanzada</h4>
                <div class="form-group">
                    <label class="form-label">Tiempo de Trabajo (segundos)</label>
                    <input type="number" class="form-input" id="workTime" min="1" value="30">
                </div>
                <div class="form-group">
                    <label class="form-label">Tiempo de Descanso (segundos)</label>
                    <input type="number" class="form-input" id="restTime" min="1" value="15">
                </div>
                <div class="form-group">
                    <label class="form-label">N√∫mero de Rondas</label>
                    <input type="number" class="form-input" id="rounds" min="1" value="5">
                </div>
                <div class="form-group">
                    <label class="form-label">Duraci√≥n Total (minutos)</label>
                    <input type="number" class="form-input" id="totalDuration" min="1" value="15">
                </div>
                <div class="form-group">
                    <label class="form-label">Direcci√≥n del Contador</label>
                    <select class="form-select" id="countDirection">
                        <option value="up">Ascendente</option>
                        <option value="down">Descendente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Intervalos Personalizados</label>
                    <textarea class="form-input" id="customIntervals" rows="3" placeholder="Formato: trabajo:descanso,rondas (ej: 30:15,8)"></textarea>
                </div>
            </div>
        </div>
        <div class="creator-actions">
            <button class="btn btn-secondary" id="cancelCreator">Cancelar</button>
            <button class="btn btn-primary" id="saveProgram">Crear Programa</button>
        </div>
    </div>

    <script>
        // Estado de la aplicaci√≥n
        const state = {
            time: 0,
            isRunning: false,
            isPaused: false,
            selectedProgram: null,
            timerInterval: null,
            programType: 'stopwatch',
            countdownTime: 300,
            clockInterval: null,
            favorites: [],
            history: [],
            programs: [
                {
                    id: 'clock',
                    icon: '‚è∞',
                    title: 'Reloj',
                    description: 'Muestra la hora actual',
                    requiresInput: false,
                    defaultConfig: {},
                    color: 'var(--info)'
                },
                {
                    id: 'stopwatch',
                    icon: '‚è±Ô∏è',
                    title: 'Cron√≥metro',
                    description: 'Cuenta el tiempo transcurrido',
                    requiresInput: false,
                    defaultConfig: {},
                    color: 'var(--success)'
                },
                {
                    id: 'countup',
                    icon: '‚ÜóÔ∏è',
                    title: 'Contador Asc',
                    description: 'Cuenta hacia arriba',
                    requiresInput: true,
                    inputs: [
                        { name: 'startTime', label: 'Tiempo Inicial (seg)', type: 'number', default: 0 }
                    ],
                    defaultConfig: { startTime: 0 },
                    color: 'var(--success)'
                },
                {
                    id: 'countdown',
                    icon: '‚ÜòÔ∏è',
                    title: 'Contador Desc',
                    description: 'Cuenta hacia atr√°s',
                    requiresInput: true,
                    inputs: [
                        { name: 'countdownTime', label: 'Tiempo (min)', type: 'number', default: 5 }
                    ],
                    defaultConfig: { countdownTime: 5 },
                    color: 'var(--danger)'
                },
                {
                    id: 'amrap',
                    icon: 'üí™',
                    title: 'AMRAP',
                    description: 'Rondas en tiempo',
                    requiresInput: true,
                    inputs: [
                        { name: 'duration', label: 'Duraci√≥n (min)', type: 'number', default: 15 }
                    ],
                    defaultConfig: { duration: 15 },
                    color: 'var(--purple)'
                },
                {
                    id: 'tabata',
                    icon: '‚ö°',
                    title: 'TABATA',
                    description: 'Intervalos 20/10',
                    requiresInput: true,
                    inputs: [
                        { name: 'rounds', label: 'N√∫mero de Rondas', type: 'number', default: 8 }
                    ],
                    defaultConfig: { rounds: 8 },
                    color: 'var(--orange)'
                },
                {
                    id: 'emom',
                    icon: 'üîÅ',
                    title: 'EMOM',
                    description: 'Cada minuto',
                    requiresInput: true,
                    inputs: [
                        { name: 'minutes', label: 'Duraci√≥n (min)', type: 'number', default: 10 },
                        { name: 'exercise', label: 'Ejercicio', type: 'text', default: 'Sentadillas' }
                    ],
                    defaultConfig: { minutes: 10, exercise: 'Sentadillas' },
                    color: 'var(--cyan)'
                },
                {
                    id: 'hiit',
                    icon: 'üî•',
                    title: 'HIIT',
                    description: 'Alto intensidad',
                    requiresInput: true,
                    inputs: [
                        { name: 'work', label: 'Trabajo (seg)', type: 'number', default: 30 },
                        { name: 'rest', label: 'Descanso (seg)', type: 'number', default: 15 },
                        { name: 'rounds', label: 'Rondas', type: 'number', default: 10 }
                    ],
                    defaultConfig: { work: 30, rest: 15, rounds: 10 },
                    color: 'var(--danger)'
                },
                {
                    id: 'fortime',
                    icon: '‚è±Ô∏è',
                    title: 'For Time',
                    description: 'Completa r√°pido',
                    requiresInput: true,
                    inputs: [
                        { name: 'exercises', label: 'Ejercicios', type: 'text', default: '20 Sentadillas, 15 Flexiones' }
                    ],
                    defaultConfig: { exercises: '20 Sentadillas, 15 Flexiones' },
                    color: 'var(--info)'
                },
                {
                    id: 'custom',
                    icon: '‚öôÔ∏è',
                    title: 'Personalizado',
                    description: 'Intervalo configurable',
                    requiresInput: true,
                    inputs: [
                        { name: 'work', label: 'Trabajo (seg)', type: 'number', default: 45 },
                        { name: 'rest', label: 'Descanso (seg)', type: 'number', default: 15 },
                        { name: 'rounds', label: 'Rondas', type: 'number', default: 5 }
                    ],
                    defaultConfig: { work: 45, rest: 15, rounds: 5 },
                    color: 'var(--teal)'
                }
            ],
            dragSource: null,
            dragTarget: null,
            customWorkouts: [],
            currentWorkout: null,
            startTime: 0,
            customPrograms: [],
            heatmapData: {}
        };

        // Elementos del DOM
        const elements = {
            sidebarToggle: document.getElementById('sidebarToggle'),
            sidebar: document.getElementById('sidebar'),
            mainContent: document.getElementById('mainContent'),
            currentTime: document.getElementById('currentTime'),
            connectionStatus: document.getElementById('connectionStatus'),
            timerDisplay: document.getElementById('timerDisplay'),
            progressBar: document.getElementById('progressBar'),
            playButton: document.getElementById('playButton'),
            pauseButton: document.getElementById('pauseButton'),
            resetButton: document.getElementById('resetButton'),
            programInfo: document.getElementById('programInfo'),
            programDetails: document.getElementById('programDetails'),
            programsGrid: document.getElementById('programsGrid'),
            darkModeBtn: document.getElementById('darkModeBtn'),
            darkModeText: document.getElementById('darkModeText'),
            dashboardBtn: document.getElementById('dashboardBtn'),
            workoutsBtn: document.getElementById('workoutsBtn'),
            statsBtn: document.getElementById('statsBtn'),
            createProgramBtn: document.getElementById('createProgramBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            programModal: document.getElementById('programModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalBody: document.getElementById('modalBody'),
            modalClose: document.getElementById('modalClose'),
            settingsPanel: document.getElementById('settingsPanel'),
            settingsClose: document.getElementById('settingsClose'),
            statsPanel: document.getElementById('statsPanel'),
            statsClose: document.getElementById('statsClose'),
            timeline: document.getElementById('timeline'),
            totalSessions: document.getElementById('totalSessions'),
            totalTime: document.getElementById('totalTime'),
            favoriteProgram: document.getElementById('favoriteProgram'),
            thisWeek: document.getElementById('thisWeek'),
            workoutsPanel: document.getElementById('workoutsPanel'),
            workoutsClose: document.getElementById('workoutsClose'),
            createWorkoutBtn: document.getElementById('createWorkoutBtn'),
            favoritesBtn: document.getElementById('favoritesBtn'),
            refreshBtn: document.getElementById('refreshBtn'),
            soundStart: document.getElementById('soundStart'),
            soundEnd: document.getElementById('soundEnd'),
            soundAlert: document.getElementById('soundAlert'),
            animations: document.getElementById('animations'),
            fullscreen: document.getElementById('fullscreen'),
            saveHistory: document.getElementById('saveHistory'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            workoutEditor: document.getElementById('workoutEditor'),
            editorClose: document.getElementById('editorClose'),
            editorProgramsGrid: document.getElementById('editorProgramsGrid'),
            workoutSequence: document.getElementById('workoutSequence'),
            previewTimeline: document.getElementById('previewTimeline'),
            cancelWorkout: document.getElementById('cancelWorkout'),
            saveWorkout: document.getElementById('saveWorkout'),
            programCreator: document.getElementById('programCreator'),
            creatorClose: document.getElementById('creatorClose'),
            programName: document.getElementById('programName'),
            programIcon: document.getElementById('programIcon'),
            programDescription: document.getElementById('programDescription'),
            programType: document.getElementById('programType'),
            workTime: document.getElementById('workTime'),
            restTime: document.getElementById('restTime'),
            rounds: document.getElementById('rounds'),
            totalDuration: document.getElementById('totalDuration'),
            countDirection: document.getElementById('countDirection'),
            customIntervals: document.getElementById('customIntervals'),
            cancelCreator: document.getElementById('cancelCreator'),
            saveProgram: document.getElementById('saveProgram'),
            primaryColor: document.getElementById('primaryColor'),
            secondaryColor: document.getElementById('secondaryColor'),
            accentColor: document.getElementById('accentColor'),
            applyTheme: document.getElementById('applyTheme'),
            primaryPreview: document.getElementById('primaryPreview'),
            secondaryPreview: document.getElementById('secondaryPreview'),
            accentPreview: document.getElementById('accentPreview'),
            heatmapGrid: document.getElementById('heatmapGrid')
        };

        // Sonidos (usando Web Audio API para evitar archivos externos)
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration, type = 'sine') {
            if (!elements.soundStart.checked && type === 'start') return;
            if (!elements.soundEnd.checked && type === 'end') return;
            if (!elements.soundAlert.checked && type === 'alert') return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = type;
            oscillator.frequency.value = frequency;
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // Actualizar hora del sistema
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('es-ES');
            elements.currentTime.textContent = `${dateString} ${timeString}`;
        }

        // Formatear tiempo para mostrar
        function formatTime(seconds) {
            if (state.programType === 'clock') {
                const now = new Date();
                return now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
            
            const mins = Math.floor(Math.abs(seconds) / 60);
            const secs = Math.abs(seconds) % 60;
            const sign = seconds < 0 ? '-' : '';
            
            return `${sign}${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Actualizar display del temporizador con colores seg√∫n el modo
        function updateTimerDisplay() {
            elements.timerDisplay.textContent = formatTime(state.time);
            
            // Cambiar color seg√∫n el tipo de programa
            elements.timerDisplay.className = 'timer-display';
            elements.timerDisplay.classList.add(state.programType);
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            let progress = 0;
            
            if (state.programType === 'countdown' && state.countdownTime > 0) {
                progress = ((state.countdownTime - state.time) / state.countdownTime) * 100;
            } else if (state.selectedProgram && state.selectedProgram.id === 'amrap') {
                // Para AMRAP, mostrar progreso basado en el tiempo transcurrido
                progress = Math.min((state.time / 900) * 100, 100); // 15 minutos m√°ximo
            } else if (state.time > 0) {
                // Para otros programas, mostrar progreso creciente
                progress = Math.min((state.time / 3600) * 100, 100); // 1 hora m√°ximo
            }
            
            elements.progressBar.style.width = `${progress}%`;
        }

        // Iniciar temporizador
        function startTimer() {
            if (state.timerInterval) return;
            
            state.isRunning = true;
            state.isPaused = false;
            state.startTime = Date.now();
            
            playSound(880, 0.2, 'sine'); // Sonido de inicio
            
            if (state.programType === 'clock') {
                state.clockInterval = setInterval(() => {
                    updateTimerDisplay();
                }, 1000);
                return;
            }
            
            state.timerInterval = setInterval(() => {
                if (state.programType === 'countdown') {
                    state.time--;
                    if (state.time <= 0) {
                        state.time = 0;
                        pauseTimer();
                        playSound(220, 1, 'sawtooth'); // Sonido de finalizaci√≥n
                    }
                } else {
                    state.time++;
                }
                updateTimerDisplay();
                updateProgressBar();
            }, 1000);
        }

        // Pausar temporizador
        function pauseTimer() {
            if (state.clockInterval) {
                clearInterval(state.clockInterval);
                state.clockInterval = null;
            }
            
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            
            state.isRunning = false;
            state.isPaused = true;
            
            if (state.time > 0 && elements.saveHistory.checked) {
                // Guardar en historial
                const historyItem = {
                    id: Date.now(),
                    program: state.selectedProgram,
                    time: state.time,
                    date: new Date().toISOString()
                };
                state.history.push(historyItem);
                localStorage.setItem('timerHistory', JSON.stringify(state.history));
                updateStatsPanel();
                updateHeatmap();
            }
        }

        // Resetear temporizador
        function resetTimer() {
            pauseTimer();
            state.time = 0;
            state.isRunning = false;
            state.isPaused = false;
            
            if (state.programType === 'countdown') {
                state.time = state.countdownTime || 300;
            }
            
            updateTimerDisplay();
            updateProgressBar();
        }

        // Manejar selecci√≥n de programa
        function handleProgramSelect(card) {
            // Remover clase seleccionada de todos
            document.querySelectorAll('.program-card').forEach(c => {
                c.classList.remove('selected');
            });
            
            // Agregar clase seleccionada al actual
            card.classList.add('selected');
            
            // Actualizar estado
            const programId = card.dataset.program;
            const program = state.programs.find(p => p.id === programId);
            state.programType = programId;
            state.selectedProgram = program;
            
            // Verificar si el programa requiere configuraci√≥n
            if (program.requiresInput) {
                showProgramModal(program);
            } else {
                applyProgramConfig(program, program.defaultConfig);
            }
        }

        // Mostrar modal de configuraci√≥n de programa
        function showProgramModal(program) {
            elements.modalTitle.textContent = `Configurar ${program.title}`;
            
            let formHTML = '<form id="programConfigForm">';
            
            program.inputs.forEach(input => {
                formHTML += `
                    <div class="form-group">
                        <label class="form-label">${input.label}</label>
                        <input type="${input.type}" class="form-input" id="${input.name}" 
                               value="${input.default}" ${input.type === 'number' ? 'min="0"' : ''}>
                    </div>
                `;
            });
            
            formHTML += `
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="modalCancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Aplicar</button>
                </div>
            `;
            
            formHTML += '</form>';
            
            elements.modalBody.innerHTML = formHTML;
            elements.programModal.classList.add('active');
            
            // Event listeners para el formulario
            document.getElementById('programConfigForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const config = {};
                program.inputs.forEach(input => {
                    const value = document.getElementById(input.name).value;
                    config[input.name] = input.type === 'number' ? parseInt(value) : value;
                });
                applyProgramConfig(program, config);
                elements.programModal.classList.remove('active');
            });
            
            document.getElementById('modalCancel').addEventListener('click', () => {
                elements.programModal.classList.remove('active');
            });
        }

        // Aplicar configuraci√≥n de programa
        function applyProgramConfig(program, config) {
            // Actualizar configuraci√≥n seg√∫n el tipo de programa
            if (program.id === 'countdown') {
                state.countdownTime = (config.countdownTime || 5) * 60;
                state.time = state.countdownTime;
            } else if (program.id === 'countup') {
                state.time = config.startTime || 0;
            } else {
                state.time = 0;
            }
            
            state.selectedProgram = program;
            state.programType = program.id;
            
            // Actualizar informaci√≥n del programa
            elements.programInfo.textContent = program.title;
            
            let detailsText = '';
            if (program.id === 'countdown') {
                detailsText = `Tiempo: ${config.countdownTime || 5} minutos`;
            } else if (program.id === 'amrap') {
                detailsText = `Duraci√≥n: ${config.duration || 15} minutos`;
            } else if (program.id === 'tabata') {
                detailsText = `Rondas: ${config.rounds || 8}`;
            } else if (program.id === 'emom') {
                detailsText = `${config.minutes || 10} minutos - ${config.exercise || 'Ejercicio'}`;
            } else if (program.id === 'hiit') {
                detailsText = `${config.work || 30}/${config.rest || 15} seg - ${config.rounds || 10} rondas`;
            } else if (program.id === 'fortime') {
                detailsText = config.exercises || 'Workout';
            } else if (program.id === 'custom') {
                detailsText = `${config.work || 45}/${config.rest || 15} seg - ${config.rounds || 5} rondas`;
            } else {
                detailsText = program.description;
            }
            
            elements.programDetails.textContent = detailsText;
            updateTimerDisplay();
            updateProgressBar();
            resetTimer();
        }

        // Toggle modo oscuro
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            // Cambiar texto
            if (document.body.classList.contains('dark-mode')) {
                elements.darkModeText.textContent = 'Modo Claro';
            } else {
                elements.darkModeText.textContent = 'Modo Oscuro';
            }
        }

        // Manejar estado de conexi√≥n
        function updateConnectionStatus() {
            if (navigator.onLine) {
                elements.connectionStatus.className = 'connection-status online';
                elements.connectionStatus.innerHTML = '<span>üì∂ Online</span>';
            } else {
                elements.connectionStatus.className = 'connection-status offline';
                elements.connectionStatus.innerHTML = '<span>üö´ Offline</span>';
            }
        }

        // Funciones para botones de la sidebar
        function toggleSidebar() {
            elements.sidebar.classList.toggle('active');
            elements.mainContent.classList.toggle('sidebar-open');
        }

        function showDashboard() {
            // Ya estamos en el dashboard
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            elements.dashboardBtn.classList.add('active');
            
            // Cerrar paneles si est√°n abiertos
            elements.settingsPanel.classList.remove('active');
            elements.statsPanel.classList.remove('active');
            elements.workoutsPanel.classList.remove('active');
            elements.workoutEditor.classList.remove('active');
            elements.programCreator.classList.remove('active');
            elements.sidebar.classList.remove('active');
            elements.mainContent.classList.remove('sidebar-open');
        }

        function showWorkouts() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            elements.workoutsBtn.classList.add('active');
            
            elements.workoutsPanel.classList.add('active');
            elements.settingsPanel.classList.remove('active');
            elements.statsPanel.classList.remove('active');
            elements.workoutEditor.classList.remove('active');
            elements.programCreator.classList.remove('active');
            elements.sidebar.classList.remove('active');
            elements.mainContent.classList.remove('sidebar-open');
        }

        function showStats() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            elements.statsBtn.classList.add('active');
            
            elements.statsPanel.classList.add('active');
            elements.settingsPanel.classList.remove('active');
            elements.workoutsPanel.classList.remove('active');
            elements.workoutEditor.classList.remove('active');
            elements.programCreator.classList.remove('active');
            elements.sidebar.classList.remove('active');
            elements.mainContent.classList.remove('sidebar-open');
            
            updateStatsPanel();
        }

        function showCreateProgram() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            elements.createProgramBtn.classList.add('active');
            
            elements.programCreator.classList.add('active');
            elements.settingsPanel.classList.remove('active');
            elements.statsPanel.classList.remove('active');
            elements.workoutsPanel.classList.remove('active');
            elements.workoutEditor.classList.remove('active');
            elements.sidebar.classList.remove('active');
            elements.mainContent.classList.remove('sidebar-open');
        }

        function showSettings() {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            elements.settingsBtn.classList.add('active');
            
            elements.settingsPanel.classList.add('active');
            elements.statsPanel.classList.remove('active');
            elements.workoutsPanel.classList.remove('active');
            elements.workoutEditor.classList.remove('active');
            elements.programCreator.classList.remove('active');
            elements.sidebar.classList.remove('active');
            elements.mainContent.classList.remove('sidebar-open');
        }

        // Mostrar editor de workouts
        function showWorkoutEditor() {
            elements.workoutEditor.classList.add('active');
            elements.workoutsPanel.classList.remove('active');
            renderEditorPrograms();
            renderWorkoutSequence();
            updatePreview();
        }

        // Renderizar programas en el editor
        function renderEditorPrograms() {
            elements.editorProgramsGrid.innerHTML = '';
            
            state.programs.forEach(program => {
                const card = document.createElement('div');
                card.className = 'program-card draggable';
                card.dataset.program = program.id;
                card.draggable = true;
                
                card.innerHTML = `
                    <div class="program-icon">${program.icon}</div>
                    <div class="program-title">${program.title}</div>
                    <div class="program-description">${program.description}</div>
                `;
                
                // Event listeners para drag and drop
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', program.id);
                    card.classList.add('dragging');
                });
                
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                });
                
                elements.editorProgramsGrid.appendChild(card);
            });
        }

        // Renderizar secuencia del workout
        function renderWorkoutSequence() {
            if (!state.currentWorkout || state.currentWorkout.sequence.length === 0) {
                elements.workoutSequence.innerHTML = `
                    <div class="sequence-placeholder" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        Arrastra programas aqu√≠ para crear tu secuencia
                    </div>
                `;
                return;
            }
            
            elements.workoutSequence.innerHTML = '';
            
            state.currentWorkout.sequence.forEach((programId, index) => {
                const program = state.programs.find(p => p.id === programId);
                if (program) {
                    const sequenceItem = document.createElement('div');
                    sequenceItem.className = 'sequence-item draggable';
                    sequenceItem.dataset.index = index;
                    sequenceItem.draggable = true;
                    
                    sequenceItem.innerHTML = `
                        <div>
                            <div class="program-icon" style="font-size: 24px; margin-bottom: 8px;">${program.icon}</div>
                            <div class="program-title">${program.title}</div>
                            <div class="program-description">${program.description}</div>
                        </div>
                        <div class="sequence-controls">
                            <button class="sequence-btn" onclick="removeFromSequence(${index})">üóëÔ∏è</button>
                            <button class="sequence-btn" onclick="moveUp(${index})">‚¨ÜÔ∏è</button>
                            <button class="sequence-btn" onclick="moveDown(${index})">‚¨áÔ∏è</button>
                        </div>
                    `;
                    
                    // Event listeners para reordenar
                    sequenceItem.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', index);
                        sequenceItem.classList.add('dragging');
                    });
                    
                    sequenceItem.addEventListener('dragend', () => {
                        sequenceItem.classList.remove('dragging');
                    });
                    
                    elements.workoutSequence.appendChild(sequenceItem);
                }
            });
        }

        // Actualizar previsualizaci√≥n
        function updatePreview() {
            if (!state.currentWorkout || state.currentWorkout.sequence.length === 0) {
                elements.previewTimeline.innerHTML = '<div style="color: var(--text-secondary); text-align: center; width: 100%;">Agrega programas para ver la previsualizaci√≥n</div>';
                return;
            }
            
            elements.previewTimeline.innerHTML = '';
            
            state.currentWorkout.sequence.forEach(programId => {
                const program = state.programs.find(p => p.id === programId);
                if (program) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <div class="preview-icon">${program.icon}</div>
                        <div class="preview-name">${program.title}</div>
                        <div class="preview-time">~2 min</div>
                    `;
                    elements.previewTimeline.appendChild(previewItem);
                }
            });
        }

        // Funciones para manipular la secuencia
        function removeFromSequence(index) {
            if (state.currentWorkout && state.currentWorkout.sequence) {
                state.currentWorkout.sequence.splice(index, 1);
                renderWorkoutSequence();
                updatePreview();
            }
        }

        function moveUp(index) {
            if (index > 0 && state.currentWorkout && state.currentWorkout.sequence) {
                const temp = state.currentWorkout.sequence[index];
                state.currentWorkout.sequence[index] = state.currentWorkout.sequence[index - 1];
                state.currentWorkout.sequence[index - 1] = temp;
                renderWorkoutSequence();
                updatePreview();
            }
        }

        function moveDown(index) {
            if (state.currentWorkout && state.currentWorkout.sequence && 
                index < state.currentWorkout.sequence.length - 1) {
                const temp = state.currentWorkout.sequence[index];
                state.currentWorkout.sequence[index] = state.currentWorkout.sequence[index + 1];
                state.currentWorkout.sequence[index + 1] = temp;
                renderWorkoutSequence();
                updatePreview();
            }
        }

        // Actualizar panel de estad√≠sticas con timeline visual
        function updateStatsPanel() {
            // Actualizar resumen
            elements.totalSessions.textContent = state.history.length;
            
            const totalTimeSeconds = state.history.reduce((sum, item) => sum + item.time, 0);
            elements.totalTime.textContent = (totalTimeSeconds / 3600).toFixed(1);
            
            // Encontrar programa favorito
            if (state.history.length > 0) {
                const programCount = {};
                state.history.forEach(item => {
                    const programId = item.program.id;
                    programCount[programId] = (programCount[programId] || 0) + 1;
                });
                
                const favoriteProgramId = Object.keys(programCount).reduce((a, b) => 
                    programCount[a] > programCount[b] ? a : b);
                
                const favoriteProgram = state.programs.find(p => p.id === favoriteProgramId);
                elements.favoriteProgram.textContent = favoriteProgram ? favoriteProgram.title : '-';
            }
            
            // Sesiones esta semana
            const oneWeekAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
            const thisWeekSessions = state.history.filter(item => 
                new Date(item.date).getTime() > oneWeekAgo
            ).length;
            elements.thisWeek.textContent = thisWeekSessions;
            
            // Actualizar timeline
            elements.timeline.innerHTML = '';
            
            // Mostrar las √∫ltimas 10 sesiones
            const recentHistory = [...state.history].reverse().slice(0, 10);
            
            recentHistory.forEach(item => {
                const program = state.programs.find(p => p.id === item.program.id);
                const date = new Date(item.date);
                const formattedDate = date.toLocaleDateString('es-ES');
                const formattedTime = date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                timelineItem.innerHTML = `
                    <div class="timeline-date">${formattedDate} ${formattedTime}</div>
                    <div class="timeline-content">
                        <div class="timeline-program">${program ? program.icon + ' ' + program.title : 'Desconocido'}</div>
                        <div class="timeline-duration">‚è±Ô∏è ${formatTime(item.time)}</div>
                    </div>
                `;
                
                elements.timeline.appendChild(timelineItem);
            });
        }

        // Generar heatmap de actividad
        function generateHeatmap() {
            elements.heatmapGrid.innerHTML = '';
            
            // Generar datos de ejemplo para el heatmap (√∫ltimos 30 d√≠as)
            const today = new Date();
            const heatmapData = {};
            
            // Generar datos aleatorios para demostraci√≥n
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateKey = date.toISOString().split('T')[0];
                heatmapData[dateKey] = Math.floor(Math.random() * 5); // 0-4 sesiones
            }
            
            // Generar d√≠as de la semana para los √∫ltimos 4 semanas
            const days = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
            
            for (let week = 0; week < 4; week++) {
                for (let day = 0; day < 7; day++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - (week * 7 + (6 - day)));
                    const dateKey = date.toISOString().split('T')[0];
                    const level = heatmapData[dateKey] || 0;
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = `heatmap-day level-${level}`;
                    dayElement.title = `${dateKey}: ${level} sesiones`;
                    dayElement.textContent = days[day];
                    
                    elements.heatmapGrid.appendChild(dayElement);
                }
            }
        }

        // Actualizar heatmap con datos reales
        function updateHeatmap() {
            // Esta funci√≥n se llamar√≠a cada vez que se complete una sesi√≥n
            // Por ahora usamos datos de ejemplo
            generateHeatmap();
        }

        // Cargar datos del localStorage
        function loadFromStorage() {
            try {
                const favorites = localStorage.getItem('timerFavorites');
                if (favorites) {
                    state.favorites = JSON.parse(favorites);
                }
                
                const history = localStorage.getItem('timerHistory');
                if (history) {
                    state.history = JSON.parse(history);
                }
                
                const customWorkouts = localStorage.getItem('customWorkouts');
                if (customWorkouts) {
                    state.customWorkouts = JSON.parse(customWorkouts);
                }
                
                const customPrograms = localStorage.getItem('customPrograms');
                if (customPrograms) {
                    state.customPrograms = JSON.parse(customPrograms);
                    // Agregar programas personalizados a la lista
                    state.programs = [...state.programs, ...state.customPrograms];
                }
                
                const theme = localStorage.getItem('customTheme');
                if (theme) {
                    const themeColors = JSON.parse(theme);
                    document.documentElement.style.setProperty('--theme-primary', themeColors.primary);
                    document.documentElement.style.setProperty('--theme-secondary', themeColors.secondary);
                    document.documentElement.style.setProperty('--theme-accent', themeColors.accent);
                }
            } catch (e) {
                console.log('Error cargando datos del localStorage:', e);
            }
        }

        // Guardar favoritos
        function saveFavorites() {
            localStorage.setItem('timerFavorites', JSON.stringify(state.favorites));
        }

        // Guardar workouts personalizados
        function saveCustomWorkouts() {
            localStorage.setItem('customWorkouts', JSON.stringify(state.customWorkouts));
        }

        // Guardar programas personalizados
        function saveCustomPrograms() {
            localStorage.setItem('customPrograms', JSON.stringify(state.customPrograms));
        }

        // Guardar tema personalizado
        function saveCustomTheme(primary, secondary, accent) {
            const theme = {
                primary: primary,
                secondary: secondary,
                accent: accent
            };
            localStorage.setItem('customTheme', JSON.stringify(theme));
        }

        // Renderizar programas
        function renderPrograms() {
            elements.programsGrid.innerHTML = '';
            
            let programsToShow = state.programs;
            
            // Si se est√° viendo solo favoritos
            if (state.showingFavorites) {
                programsToShow = state.programs.filter(p => state.favorites.includes(p.id));
            }
            
            programsToShow.forEach(program => {
                const card = document.createElement('div');
                card.className = 'program-card';
                card.dataset.program = program.id;
                card.draggable = true;
                
                const isFavorite = state.favorites.includes(program.id);
                
                card.innerHTML = `
                    <button class="program-favorite ${isFavorite ? 'active' : ''}" data-program="${program.id}">
                        ${isFavorite ? '‚òÖ' : '‚òÜ'}
                    </button>
                    <div class="program-icon">${program.icon}</div>
                    <div class="program-title">${program.title}</div>
                    <div class="program-description">${program.description}</div>
                `;
                
                // Event listeners
                card.addEventListener('click', () => handleProgramSelect(card));
                
                // Drag and drop mejorado
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('dragenter', handleDragEnter);
                card.addEventListener('dragleave', handleDragLeave);
                card.addEventListener('drop', handleDrop);
                card.addEventListener('dragend', handleDragEnd);
                
                // Event listener para favorito
                const favoriteBtn = card.querySelector('.program-favorite');
                favoriteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(program.id);
                    favoriteBtn.classList.toggle('active');
                    favoriteBtn.textContent = favoriteBtn.classList.contains('active') ? '‚òÖ' : '‚òÜ';
                });
                
                elements.programsGrid.appendChild(card);
            });
        }

        // Toggle favorito
        function toggleFavorite(programId) {
            const index = state.favorites.indexOf(programId);
            if (index > -1) {
                state.favorites.splice(index, 1);
            } else {
                state.favorites.push(programId);
            }
            saveFavorites();
        }

        // Drag and Drop handlers - Mejorados
        function handleDragStart(e) {
            state.dragSource = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            // Determinar posici√≥n de inserci√≥n
            const rect = this.getBoundingClientRect();
            const midpoint = (rect.top + rect.bottom) / 2;
            
            this.classList.remove('drag-over-top', 'drag-over-bottom');
            
            if (e.clientY < midpoint) {
                this.classList.add('drag-over-top');
            } else {
                this.classList.add('drag-over-bottom');
            }
            
            return false;
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
        }

        function handleDrop(e) {
            e.stopPropagation();
            e.preventDefault();
            
            this.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
            
            if (state.dragSource !== this) {
                // Reordenar elementos
                const allCards = Array.from(elements.programsGrid.children);
                const sourceIndex = allCards.indexOf(state.dragSource);
                const targetIndex = allCards.indexOf(this);
                
                if (sourceIndex < targetIndex) {
                    elements.programsGrid.insertBefore(state.dragSource, this.nextSibling);
                } else {
                    elements.programsGrid.insertBefore(state.dragSource, this);
                }
            }
            
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.program-card').forEach(card => {
                card.classList.remove('drag-over', 'drag-over-top', 'drag-over-bottom');
            });
            state.dragSource = null;
        }

        // Event Listeners
        elements.playButton.addEventListener('click', () => {
            if (state.isRunning) {
                pauseTimer();
                elements.playButton.textContent = '‚ñ∂Ô∏è';
            } else {
                startTimer();
                elements.playButton.textContent = '‚è∏Ô∏è';
            }
        });

        elements.resetButton.addEventListener('click', resetTimer);

        elements.sidebarToggle.addEventListener('click', toggleSidebar);
        
        elements.darkModeBtn.addEventListener('click', toggleDarkMode);
        elements.dashboardBtn.addEventListener('click', showDashboard);
        elements.workoutsBtn.addEventListener('click', showWorkouts);
        elements.statsBtn.addEventListener('click', showStats);
        elements.createProgramBtn.addEventListener('click', showCreateProgram);
        elements.settingsBtn.addEventListener('click', showSettings);

        elements.modalClose.addEventListener('click', () => {
            elements.programModal.classList.remove('active');
        });

        elements.settingsClose.addEventListener('click', () => {
            elements.settingsPanel.classList.remove('active');
        });

        elements.statsClose.addEventListener('click', () => {
            elements.statsPanel.classList.remove('active');
        });

        elements.workoutsClose.addEventListener('click', () => {
            elements.workoutsPanel.classList.remove('active');
        });

        elements.editorClose.addEventListener('click', () => {
            elements.workoutEditor.classList.remove('active');
        });

        elements.creatorClose.addEventListener('click', () => {
            elements.programCreator.classList.remove('active');
        });

        elements.createWorkoutBtn.addEventListener('click', () => {
            state.currentWorkout = {
                name: 'Nuevo Workout',
                sequence: []
            };
            showWorkoutEditor();
        });

        elements.cancelWorkout.addEventListener('click', () => {
            elements.workoutEditor.classList.remove('active');
        });

        elements.saveWorkout.addEventListener('click', () => {
            if (state.currentWorkout && state.currentWorkout.sequence.length > 0) {
                state.currentWorkout.id = Date.now();
                state.customWorkouts.push(state.currentWorkout);
                saveCustomWorkouts();
                elements.workoutEditor.classList.remove('active');
                alert('Workout guardado correctamente!');
            } else {
                alert('Por favor agrega al menos un programa a la secuencia');
            }
        });

        elements.favoritesBtn.addEventListener('click', () => {
            state.showingFavorites = !state.showingFavorites;
            elements.favoritesBtn.textContent = state.showingFavorites ? '‚≠ê' : '‚òÜ';
            renderPrograms();
        });

        elements.refreshBtn.addEventListener('click', renderPrograms);

        elements.clearHistoryBtn.addEventListener('click', () => {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todo el historial?')) {
                state.history = [];
                localStorage.removeItem('timerHistory');
                updateStatsPanel();
            }
        });

        // Event listeners para drag and drop en el editor
        elements.workoutSequence.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });

        elements.workoutSequence.addEventListener('drop', (e) => {
            e.preventDefault();
            const programId = e.dataTransfer.getData('text/plain');
            if (programId) {
                if (!state.currentWorkout) {
                    state.currentWorkout = {
                        name: 'Nuevo Workout',
                        sequence: []
                    };
                }
                state.currentWorkout.sequence.push(programId);
                renderWorkoutSequence();
                updatePreview();
            }
        });

        // Event listener para crear programa
        elements.saveProgram.addEventListener('click', () => {
            const name = elements.programName.value.trim();
            const icon = elements.programIcon.value;
            const description = elements.programDescription.value.trim();
            const type = elements.programType.value;
            const workTime = parseInt(elements.workTime.value) || 30;
            const restTime = parseInt(elements.restTime.value) || 15;
            const rounds = parseInt(elements.rounds.value) || 5;
            const totalDuration = parseInt(elements.totalDuration.value) || 15;
            const countDirection = elements.countDirection.value;
            const customIntervals = elements.customIntervals.value.trim();
            
            if (!name) {
                alert('Por favor ingresa un nombre para el programa');
                return;
            }
            
            const newProgram = {
                id: 'custom_' + Date.now(),
                icon: icon,
                title: name,
                description: description,
                requiresInput: true,
                inputs: [],
                defaultConfig: {},
                color: 'var(--teal)',
                workTime: workTime,
                restTime: restTime,
                rounds: rounds,
                totalDuration: totalDuration,
                countDirection: countDirection,
                customIntervals: customIntervals
            };
            
            // Configurar inputs seg√∫n el tipo de programa
            switch(type) {
                case 'countdown':
                    newProgram.inputs = [
                        { name: 'countdownTime', label: 'Tiempo (min)', type: 'number', default: totalDuration }
                    ];
                    newProgram.defaultConfig = { countdownTime: totalDuration };
                    break;
                case 'countup':
                    newProgram.inputs = [
                        { name: 'startTime', label: 'Tiempo Inicial (seg)', type: 'number', default: 0 }
                    ];
                    newProgram.defaultConfig = { startTime: 0 };
                    break;
                case 'amrap':
                    newProgram.inputs = [
                        { name: 'duration', label: 'Duraci√≥n (min)', type: 'number', default: totalDuration }
                    ];
                    newProgram.defaultConfig = { duration: totalDuration };
                    break;
                case 'tabata':
                    newProgram.inputs = [
                        { name: 'rounds', label: 'N√∫mero de Rondas', type: 'number', default: rounds }
                    ];
                    newProgram.defaultConfig = { rounds: rounds };
                    break;
                case 'custom':
                    newProgram.inputs = [
                        { name: 'work', label: 'Trabajo (seg)', type: 'number', default: workTime },
                        { name: 'rest', label: 'Descanso (seg)', type: 'number', default: restTime },
                        { name: 'rounds', label: 'Rondas', type: 'number', default: rounds }
                    ];
                    newProgram.defaultConfig = { work: workTime, rest: restTime, rounds: rounds };
                    break;
            }
            
            state.customPrograms.push(newProgram);
            state.programs.push(newProgram);
            saveCustomPrograms();
            renderPrograms();
            elements.programCreator.classList.remove('active');
            alert('Programa creado correctamente!');
            
            // Limpiar formulario
            elements.programName.value = '';
            elements.programDescription.value = '';
            elements.programIcon.value = 'üí™';
            elements.programType.value = 'countdown';
            elements.workTime.value = '30';
            elements.restTime.value = '15';
            elements.rounds.value = '5';
            elements.totalDuration.value = '15';
            elements.countDirection.value = 'up';
            elements.customIntervals.value = '';
        });

        elements.cancelCreator.addEventListener('click', () => {
            elements.programCreator.classList.remove('active');
        });

        // Event listener para el reloj - iniciar autom√°ticamente
        elements.currentTime.addEventListener('click', () => {
            // Encontrar el programa de reloj
            const clockProgram = state.programs.find(p => p.id === 'clock');
            if (clockProgram) {
                // Seleccionar el programa de reloj
                const clockCard = document.querySelector(`.program-card[data-program="clock"]`);
                if (clockCard) {
                    handleProgramSelect(clockCard);
                    // Iniciar autom√°ticamente
                    if (!state.isRunning) {
                        startTimer();
                        elements.playButton.textContent = '‚è∏Ô∏è';
                    }
                }
            }
        });

        // Event listeners para temas personalizados
        elements.primaryColor.addEventListener('input', (e) => {
            elements.primaryPreview.style.backgroundColor = e.target.value;
        });

        elements.secondaryColor.addEventListener('input', (e) => {
            elements.secondaryPreview.style.backgroundColor = e.target.value;
        });

        elements.accentColor.addEventListener('input', (e) => {
            elements.accentPreview.style.backgroundColor = e.target.value;
        });

        elements.applyTheme.addEventListener('click', () => {
            const primary = elements.primaryColor.value;
            const secondary = elements.secondaryColor.value;
            const accent = elements.accentColor.value;
            
            document.documentElement.style.setProperty('--theme-primary', primary);
            document.documentElement.style.setProperty('--theme-secondary', secondary);
            document.documentElement.style.setProperty('--theme-accent', accent);
            
            saveCustomTheme(primary, secondary, accent);
            alert('Tema aplicado correctamente!');
        });

        // Cerrar modales y paneles al hacer clic fuera
        window.addEventListener('click', (e) => {
            if (e.target === elements.programModal) {
                elements.programModal.classList.remove('active');
            }
        });

        // Manejar eventos de conexi√≥n
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);

        // Inicializaci√≥n
        function init() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            updateConnectionStatus();
            updateTimerDisplay();
            updateProgressBar();
            
            // Cargar datos guardados
            loadFromStorage();
            
            // Renderizar programas
            renderPrograms();
            
            // Actualizar panel de estad√≠sticas
            updateStatsPanel();
            
            // Generar heatmap
            generateHeatmap();
            
            // Seleccionar el cron√≥metro por defecto
            const defaultCard = document.querySelector('.program-card[data-program="stopwatch"]');
            if (defaultCard) {
                handleProgramSelect(defaultCard);
            }
        }

        // Iniciar aplicaci√≥n
        init();
    </script>
</body>
</html>
